###############################################################################
#
# IAR ANSI C/C++ Compiler V8.50.1.245/W32 for ARM         14/May/2020  16:51:02
# Copyright 1999-2020 IAR Systems AB.
#
#    Cpu mode             
#    Endian            =  little
#    Source file       =
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\drv\Generated_Code\RealTimeClock.c
#    Command line      =
#        -f C:\Users\81901\AppData\Local\Temp\EW6004.tmp
#        (C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\drv\Generated_Code\RealTimeClock.c
#        --preprocess=s
#        "C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\kl16z128_eslora
#        MQXLite\List" -lcN
#        "C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\kl16z128_eslora
#        MQXLite\List" -o
#        "C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\kl16z128_eslora
#        MQXLite\Obj" --no_cse --no_unroll --no_inline --no_code_motion
#        --no_tbaa --no_clustering --no_scheduling --debug --endian=little
#        --cpu=Cortex-M0+ -e --fpu=None --dlib_config "C:\Program Files
#        (x86)\IAR Systems\Embedded Workbench
#        8.4\arm\inc\c\DLib_Config_Normal.h" -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\Sources\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\MQXLITE\include\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\MQXLITE\config\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\MQXLITE\psp\cortex_m\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\MQXLITE\psp\cortex_m\compiler\iar\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Generated_Code\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\PExSupport\Kinetis\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\OSAbstraction\MQXLite\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\RNG\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\Common\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\Utils\Lists\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\Utils\FunctionLib\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\Utils\SecLib\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\FSCI\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\FSCI\Source\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\Panic\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\SerialManager\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\MemManager\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\TimersManager\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\TimersManager\Source\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\Messaging\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\RNG\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\framework\RNG\Source\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\ieee_802_15_4\Phy\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\ieee_802_15_4\SMAC\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\ADC\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\BME\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\Flash\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\I2C\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\LED\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\LLWU\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\LPTMR\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\SMC\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\MCG\Interface\
#        -I
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\..\drv\Portable\Reset\
#        -On)
#    Locale            =  C
#    List file         =
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\kl16z128_eslora
#        MQXLite\List\RealTimeClock.lst
#    Object file       =
#        C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\app\kl16z128_eslora
#        MQXLite\Obj\RealTimeClock.o
#    Runtime model:       
#      __SystemLibrary =  DLib
#      __dlib_version  =  6
#
###############################################################################

C:\Users\81901\Desktop\job\es920lr\SDK\src\Application\KL16_SMAC_MQXLite\drv\Generated_Code\RealTimeClock.c
      1          /* ###################################################################
      2          **     THIS COMPONENT MODULE IS GENERATED BY THE TOOL. DO NOT MODIFY IT.
      3          **     Filename    : RealTimeClock.c
      4          **     Project     : ProcessorExpert
      5          **     Processor   : MKL26Z128VLL4
      6          **     Component   : RTC_LDD
      7          **     Version     : Component 01.163, Driver 01.06, CPU db: 3.00.000
      8          **     Compiler    : IAR ARM C Compiler
      9          **     Date/Time   : 2014-10-10, 12:09, # CodeGen: 152
     10          **     Abstract    :
     11          **         This component implements a real time clock (RTC). Actual date may also be
     12          **         obtained and an alarm function is included.
     13          **     Settings    :
     14          **          Component name                                 : RealTimeClock
     15          **          Device                                         : RTC
     16          **          Input clock frequency [s]                      : 1 sec
     17          **          Clock source                                   : ERCLK32K
     18          **            Clock frequency [kHz]                        : 32.768 kHz 32.768 kHz
     19          **          Interrupt service/event                        : Enabled
     20          **            Interrupt                                    : INT_RTC
     21          **            Interrupt priority                           : medium priority
     22          **            Interrupt                                    : INT_RTC_Seconds
     23          **            Interrupt priority                           : medium priority
     24          **          Min year                                       : 2000
     25          **          Max year                                       : 2099
     26          **          Initialization                                 :
     27          **            Auto Initialization                          : no
     28          **            Event mask                                   :
     29          **              OnAlarm                                    : Enabled
     30          **              OnSecond                                   : Disabled
     31          **              OnTimeOverflow                             : Disabled
     32          **              OnTimeInvalid                              : Disabled
     33          **            Time and date settings                       :
     34          **              Time                                       : 12:00:01 am
     35          **              Date                                       : 2000-01-01
     36          **            Alarm settings                               : Enabled
     37          **              Alarm time                                 : 12:00:00 am
     38          **              Alarm date                                 : 2000-01-01
     39          **            Compensation settings                        :
     40          **              Compensation period [s]                    : 0
     41          **              Compensation value [clock cycles]          : 0
     42          **     Contents    :
     43          **         Init    - LDD_TDeviceData * RealTimeClock_Init(LDD_TUserData *UserDataPtr, bool SoftInit);
     44          **         Enable  - LDD_TError RealTimeClock_Enable(LDD_TDeviceData *DeviceDataPtr);
     45          **         Disable - LDD_TError RealTimeClock_Disable(LDD_TDeviceData *DeviceDataPtr);
     46          **         GetTime - void RealTimeClock_GetTime(LDD_TDeviceData *DeviceDataPtr, LDD_RTC_TTime...
     47          **         SetTime - LDD_TError RealTimeClock_SetTime(LDD_TDeviceData *DeviceDataPtr,...
     48          **
     49          **     Copyright : 1997 - 2013 Freescale Semiconductor, Inc. All Rights Reserved.
     50          **     SOURCE DISTRIBUTION PERMISSIBLE as directed in End User License Agreement.
     51          **
     52          **     http      : www.freescale.com
     53          **     mail      : support@freescale.com
     54          ** ###################################################################*/
     55          /*!
     56          ** @file RealTimeClock.c
     57          ** @version 01.06
     58          ** @brief
     59          **         This component implements a real time clock (RTC). Actual date may also be
     60          **         obtained and an alarm function is included.
     61          */
     62          /*!
     63          **  @addtogroup RealTimeClock_module RealTimeClock module documentation
     64          **  @{
     65          */
     66          
     67          /* MODULE RealTimeClock. */
     68          
     69          #include "Events.h"
     70          #include "RealTimeClock.h"
     71          /* MQX Lite include files */
     72          #include "mqxlite.h"
     73          #include "mqxlite_prv.h"
     74          #include "RTC_PDD.h"
     75          
     76          #ifdef __cplusplus
     77          extern "C" {
     78          #endif
     79          typedef struct {
     80            bool                       EnUser;             /* User state variable */
     81            LDD_TUserData           *UserDataPtr;          /* Device mode user device data structure */
     82            LDD_RTOS_TISRVectorSettings SavedISRSettings_RTC_ISR; /* {MQXLite RTOS Adapter} Saved settings of allocated interrupt vector */
     83          } RealTimeClock_TDeviceData, *RealTimeClock_TDeviceDataPtr; /* Device data structure type */
     84          
     85          /* {MQXLite RTOS Adapter} Static object used for simulation of dynamic driver memory allocation */
     86          static RealTimeClock_TDeviceData DevDataPtr__DEFAULT_RTOS_ALLOC;
     87          /* Table of month length (in days) */
     88          static const uint8_t ULY[] = {0U,31U,28U,31U,30U,31U,30U,31U,31U,30U,31U,30U,31U}; /* Non-leap-year */
     89          static const uint8_t  LY[] = {0U,31U,29U,31U,30U,31U,30U,31U,31U,30U,31U,30U,31U}; /* Leap-year */
     90          /* Number of days from begin of the year */
     91          static const uint16_t MONTH_DAYS[] = {0U,0U,31U,59U,90U,120U,151U,181U,212U,243U,273U,304U,334U}; /* Leap-year */
     92          
     93          /*
     94          ** ===================================================================
     95          **     Method      :  RealTimeClock_Init (component RTC_LDD)
     96          */
     97          /*!
     98          **     @brief
     99          **         Initializes the device. There are two modes of
    100          **         initialization.
    101          **         1) RTC device is NOT battery backed up. (SoftInit = FALSE)
    102          **         All registers (interrupts, counters, clock routing …) that
    103          **         influence RTC behavior are initialized.
    104          **         Note: This initialization mode doesn't preserve time and
    105          **         date settings.
    106          **         2) RTC device IS battery backed up.
    107          **         (SoftInit = TRUE). Only registers that are not backed up are
    108          **         initialized (Interrupt priority …). RTC device is running,
    109          **         time and date a preserved, RTC interrupts (events) are
    110          **         preserved too.
    111          **         Allocates memory for the device data structure.
    112          **         This method can be called only once. Before the second call
    113          **         of Init() the Deinit() must be called first.
    114          **     @param
    115          **         UserDataPtr     - Pointer to the user or
    116          **                           RTOS specific data. This pointer will be
    117          **                           passed as an event or callback parameter.
    118          **     @param
    119          **         SoftInit        - If set to "[true]" only
    120          **                           registers that are not battery backup are
    121          **                           initialized (E.g. Interrupt priority in
    122          **                           interrupt controller … )
    123          **                           If set to "[false]" all registers are
    124          **                           initialized.
    125          **     @return
    126          **                         - Pointer to the dynamically allocated private
    127          **                           structure or NULL if there was an error.
    128          */
    129          /* ===================================================================*/
    130          LDD_TDeviceData * RealTimeClock_Init(LDD_TUserData *UserDataPtr, bool SoftInit)
    131          {
    132            RealTimeClock_TDeviceData *DevDataPtr;
    133          
    134            /* Allocate RTC device structure */
    135            /* {MQXLite RTOS Adapter} Driver memory allocation: Dynamic allocation is simulated by a pointer to the static object */
    136            DevDataPtr = &DevDataPtr__DEFAULT_RTOS_ALLOC;
    137            DevDataPtr->UserDataPtr = UserDataPtr; /* Store the user data */
    138            /* Allocate interrupt vector(s) */
    139            /* {MQXLite RTOS Adapter} Save old and set new interrupt vector (function handler and ISR parameter) */
    140            /* Note: Exception handler for interrupt is not saved, because it is not modified */
    141            DevDataPtr->SavedISRSettings_RTC_ISR.isrData = _int_get_isr_data(LDD_ivIndex_INT_RTC);
    142            DevDataPtr->SavedISRSettings_RTC_ISR.isrFunction = _int_install_isr(LDD_ivIndex_INT_RTC, RealTimeClock_Interrupt, DevDataPtr);
    143            /* Registration of the device structure */
    144            PE_LDD_RegisterDeviceStructure(PE_LDD_COMPONENT_RealTimeClock_ID,DevDataPtr);
    145            DevDataPtr->EnUser = TRUE;           /* Initialize user state variable */
    146            /* Enable module clock */
    147            /* SIM_SCGC6: RTC=1 */
    148            SIM_SCGC6 |= SIM_SCGC6_RTC_MASK;
    149            if (!SoftInit) {
    150              RTC_SR = 0x00U;                    /* Disable counter */
    151              RTC_TPR = RTC_TPR_TPR(0x00);       /* Set prescaler register */
    152              RTC_TSR = RTC_TSR_TSR(0x02);       /* Set second register - 2000-01-01 0:0:1 */
    153              RTC_TAR = RTC_TAR_TAR(0x00);       /* Set alarm register - 2000-01-01 0:0:0 */
    154              RTC_TCR = RTC_TCR_CIC(0x00) |
    155                        RTC_TCR_TCV(0x00) |
    156                        RTC_TCR_CIR(0x00) |
    157                        RTC_TCR_TCR(0x00);       /* Set compensation */
    158              RTC_SR = RTC_SR_TCE_MASK;          /* Enable counter */
    159            }
    160            /* Enable interrupt */
    161            /* RTC_IER: TAIE=1,TOIE=0,TIIE=0 */
    162            RTC_IER = RTC_IER_TAIE_MASK;         /* Enable interrupts */
    163            /* NVIC_IPR5: PRI_20=0x80 */
    164            NVIC_IPR5 = (uint32_t)((NVIC_IPR5 & (uint32_t)~(uint32_t)(
    165                         NVIC_IP_PRI_20(0x7F)
    166                        )) | (uint32_t)(
    167                         NVIC_IP_PRI_20(0x80)
    168                        ));
    169            /* NVIC_ISER: SETENA|=0x00100000 */
    170            NVIC_ISER |= NVIC_ISER_SETENA(0x00100000);
    171            return DevDataPtr;
    172          }
    173          
    174          /*
    175          ** ===================================================================
    176          **     Method      :  RealTimeClock_Enable (component RTC_LDD)
    177          */
    178          /*!
    179          **     @brief
    180          **         Enables the real-time clock module (Typically sets the
    181          **         module enable bit). All other HW settings are preserved. RTC
    182          **         module can be disabled by the [Disable] method and
    183          **         reinitialized by the [Init] method.
    184          **     @param
    185          **         DeviceDataPtr   - Pointer to device data
    186          **                           structure pointer returned by [Init] method.
    187          **     @return
    188          **                         - Error code, possible codes:
    189          **                           ERR_OK - OK
    190          */
    191          /* ===================================================================*/
    192          LDD_TError RealTimeClock_Enable(LDD_TDeviceData *DeviceDataPtr)
    193          {
    194            RealTimeClock_TDeviceDataPtr DevDataPtr = (RealTimeClock_TDeviceDataPtr)DeviceDataPtr;
    195          
    196            DevDataPtr->EnUser = TRUE;
    197            RTC_PDD_EnableCounter(RTC_BASE_PTR, PDD_ENABLE);
    198            return ERR_OK;
    199          }
    200          
    201          /*
    202          ** ===================================================================
    203          **     Method      :  RealTimeClock_Disable (component RTC_LDD)
    204          */
    205          /*!
    206          **     @brief
    207          **         Disables the real-time clock module. All other HW settings
    208          **         are preserved. RTC module can be enabled by [Enable] method.
    209          **     @param
    210          **         DeviceDataPtr   - Pointer to device data
    211          **                           structure pointer returned by [Init] method.
    212          **     @return
    213          **                         - Error code, possible codes:
    214          **                           ERR_OK - OK
    215          */
    216          /* ===================================================================*/
    217          LDD_TError RealTimeClock_Disable(LDD_TDeviceData *DeviceDataPtr)
    218          {
    219            RealTimeClock_TDeviceDataPtr DevDataPtr = (RealTimeClock_TDeviceDataPtr)DeviceDataPtr;
    220          
    221            DevDataPtr->EnUser = FALSE;
    222            RTC_PDD_EnableCounter(RTC_BASE_PTR, PDD_DISABLE);
    223            return ERR_OK;
    224          }
    225          
    226          /*
    227          ** ===================================================================
    228          **     Method      :  RealTimeClock_GetTime (component RTC_LDD)
    229          */
    230          /*!
    231          **     @brief
    232          **         Returns actual time and date.
    233          **         Note: Fields not supported by HW are calculated in software.
    234          **     @param
    235          **         DeviceDataPtr   - Pointer to device data
    236          **                           structure pointer returned by [Init] method.
    237          **     @param
    238          **         TimePtr         - Pointer to the time structure to
    239          **                           fill with current time.
    240          */
    241          /* ===================================================================*/
    242          void RealTimeClock_GetTime(LDD_TDeviceData *DeviceDataPtr, LDD_RTC_TTime *TimePtr)
    243          {
    244            uint32_t x;
    245            uint32_t Seconds, Days;
    246          
    247            (void)DeviceDataPtr;                 /* Parameter is not used, suppress unused argument warning */
    248            Seconds = RTC_PDD_ReadTimeSecondsReg(RTC_BASE_PTR); /* Seconds since 2000-01-01 */
    249            Seconds--;
    250            Days = Seconds / 86400U;             /* Days */
    251            Seconds = Seconds % 86400U;          /* Seconds left */
    252            TimePtr->Hour = Seconds / 3600U;     /* Hours */
    253            Seconds = Seconds % 3600u;           /* Seconds left */
    254            TimePtr->Minute = Seconds / 60U;     /* Minutes */
    255            TimePtr->Second = Seconds % 60U;     /* Seconds */
    256            TimePtr->DayOfWeek = (Days + 6U) % 7U; /* Day of week */
    257            TimePtr->Year = (4U * (Days / ((4U * 365U) + 1U))) + 2000U; /* Year */
    258            Days = Days % ((4U * 365U) + 1U);
    259            if (Days == ((0U * 365U) + 59U)) { /* 59 */
    260              TimePtr->Day = 29U;
    261              TimePtr->Month = 2U;
    262              return;
    263            } else if (Days > ((0U * 365U) + 59U)) {
    264              Days--;
    265            } else {
    266            }
    267            x =  Days / 365U;
    268            TimePtr->Year += x;
    269            Days -= x * 365U;
    270            for (x=1U; x <= 12U; x++) {
    271              if (Days < ULY[x]) {
    272                TimePtr->Month = x;
    273                break;
    274              } else {
    275                Days -= ULY[x];
    276              }
    277            }
    278            TimePtr->Day = Days + 1U;
    279          }
    280          
    281          /*
    282          ** ===================================================================
    283          **     Method      :  RealTimeClock_SetTime (component RTC_LDD)
    284          */
    285          /*!
    286          **     @brief
    287          **         Sets new time and date.
    288          **         Note: All LDD_RTC_TTime structure members must be correctly
    289          **         filled in.
    290          **     @param
    291          **         DeviceDataPtr   - Pointer to device data
    292          **                           structure pointer returned by [Init] method.
    293          **     @param
    294          **         TimePtr         - Pointer to the time structure with
    295          **                           new time to set.
    296          **     @return
    297          **                         - Error code, possible codes:
    298          **                           - ERR_OK - OK.
    299          **                           - ERR_DISABLED - Component is disabled.
    300          **                           - ERR_SPEED - Component does not work in
    301          **                           the active clock configuration.
    302          **                           - ERR_RANGE - Parameter out of range.
    303          */
    304          /* ===================================================================*/
    305          LDD_TError RealTimeClock_SetTime(LDD_TDeviceData *DeviceDataPtr, LDD_RTC_TTime *TimePtr)
    306          {
    307            uint32_t Seconds;
    308            RealTimeClock_TDeviceDataPtr DevDataPtr = (RealTimeClock_TDeviceDataPtr)DeviceDataPtr;
    309          
    310            /* Device state test - this test can be disabled by setting the "Ignore enable test"
    311               property to the "yes" value in the "Configuration inspector" */
    312            if (!DevDataPtr->EnUser) {           /* Is the device disabled by user? */
    313              return ERR_DISABLED;               /* If yes then error */
    314            }
    315            if ((TimePtr->Year < 2000U) || (TimePtr->Year > 2099U) || (TimePtr->Month > 12U) || (TimePtr->Month == 0U) || (TimePtr->Day > 31U) || (TimePtr->Day == 0U)) { /* Test correctness of given parameters */
    316              return ERR_RANGE;                  /* If not correct then error */
    317            }
    318            if (TimePtr->Year & 3U) {            /* Is given year non-leap-one? */
    319              if (ULY[TimePtr->Month] < TimePtr->Day) { /* Does the obtained number of days exceed number of days in the appropriate month & year? */
    320                return ERR_RANGE;                /* If yes (incorrect date inserted) then error */
    321              }
    322            } else {                             /* Is given year leap-one? */
    323              if (LY[TimePtr->Month] < TimePtr->Day) { /* Does the obtained number of days exceed number of days in the appropriate month & year? */
    324                return ERR_RANGE;                /* If yes (incorrect date inserted) then error */
    325              }
    326            }
    327            Seconds = ((TimePtr->Year - 2000U) * 365U) + (((TimePtr->Year - 2000U) + 3U) / 4U); /* Compute number of days from 2000 till given year */
    328            Seconds += MONTH_DAYS[TimePtr->Month]; /* Add number of days till given month */
    329            Seconds += TimePtr->Day;             /* Add days in given month */
    330            if ((TimePtr->Year & 3U) || (TimePtr->Month <= 2U)) { /* For non-leap year or month <= 2, decrement day counter */
    331              Seconds--;
    332            }
    333            Seconds = (Seconds * 86400U) + (TimePtr->Hour * 3600U) + (TimePtr->Minute * 60U) + TimePtr->Second;
    334            Seconds++;
    335            RTC_PDD_EnableCounter(RTC_BASE_PTR, PDD_DISABLE); /* Disable counter */
    336            RTC_PDD_WriteTimePrescalerReg(RTC_BASE_PTR, 0x00U); /* Clear prescaler */
    337            RTC_PDD_WriteTimeSecondsReg(RTC_BASE_PTR, Seconds); /* Set seconds counter */
    338            RTC_PDD_EnableCounter(RTC_BASE_PTR, PDD_ENABLE); /* Enable counter */
    339            return ERR_OK;
    340          }
    341          
    342          /*
    343          ** ===================================================================
    344          **     Method      :  RealTimeClock_Interrupt (component RTC_LDD)
    345          **
    346          **     Description :
    347          **         RTC interrupt handler
    348          **         This method is internal. It is used by Processor Expert only.
    349          ** ===================================================================
    350          */
    351          void RealTimeClock_Interrupt(LDD_RTOS_TISRParameter _isrParameter)
    352          {
    353            /* {MQXLite RTOS Adapter} ISR parameter is passed as parameter from RTOS interrupt dispatcher */
    354            RealTimeClock_TDeviceDataPtr DevDataPtr = (RealTimeClock_TDeviceDataPtr)_isrParameter;
    355            uint32_t Status = RTC_PDD_ReadStatusReg(RTC_BASE_PTR);
    356          
    357            if ((Status & RTC_PDD_TIF_INT) != 0x00U) { /* Timer invalid (Vbat POR or RTC SW reset)? */
    358              /* Restart RTC module */
    359              RTC_PDD_EnableCounter(RTC_BASE_PTR, PDD_DISABLE); /* Disable counter */
    360              RTC_PDD_WriteTimePrescalerReg(RTC_BASE_PTR, 0x00U); /* Reset prescaler */
    361              RTC_PDD_WriteTimeSecondsReg(RTC_BASE_PTR, 0x02UL); /* Set init. time - 2000-01-01 0:0:1 (clears flag)*/
    362            } else if ((Status & RTC_PDD_TOF_INT) != 0x00u) { /* Timer overflow ? */
    363              /* Restart RTC module */
    364              RTC_PDD_EnableCounter(RTC_BASE_PTR, PDD_DISABLE); /* Disable counter */
    365              RTC_PDD_WriteTimePrescalerReg(RTC_BASE_PTR, 0x00U); /* Reset prescaler */
    366              RTC_PDD_WriteTimeSecondsReg(RTC_BASE_PTR, 0x02UL); /* Set init. time - 2000-01-01 0:0:1 (clears flag)*/
    367            } else {                             /* Alarm interrupt */
    368              RTC_PDD_WriteTimeAlarmReg(RTC_BASE_PTR, RTC_PDD_ReadTimeAlarmReg(RTC_BASE_PTR)); /* Clear alarm interrupt flag */
    369              RealTimeClock_OnAlarm(DevDataPtr->UserDataPtr);
    370            }
    371          }
    372          
    373          /*
    374          ** ===================================================================
    375          **     Method      :  RealTimeClock_SetClockConfiguration (component RTC_LDD)
    376          **
    377          **     Description :
    378          **         This method changes the clock configuration. During a clock
    379          **         configuration change the component changes it's setting
    380          **         immediately upon a request.
    381          **         This method is internal. It is used by Processor Expert only.
    382          ** ===================================================================
    383          */
    384          void RealTimeClock_SetClockConfiguration(LDD_TDeviceData *DeviceDataPtr, LDD_TClockConfiguration ClockConfiguration)
    385          {
    386            (void)DeviceDataPtr;                 /* Parameter is not used, suppress unused argument warning */
    387            (void)ClockConfiguration;            /* Parameter is not used, suppress unused argument warning */
    388          }
    389          
    390          /* END RealTimeClock. */
    391          
    392          #ifdef __cplusplus
    393          }  /* extern "C" */
    394          #endif
    395          
    396          /*!
    397          ** @}
    398          */
    399          /*
    400          ** ###################################################################
    401          **
    402          **     This file was created by Processor Expert 10.3 [05.09]
    403          **     for the Freescale Kinetis series of microcontrollers.
    404          **
    405          ** ###################################################################
    406          */

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   RealTimeClock_Disable
       0   RealTimeClock_Enable
      24   RealTimeClock_GetTime
        24 __aeabi_uidiv
        24 __aeabi_uidivmod
      16   RealTimeClock_Init
        16   -> _int_get_isr_data
        16   -> _int_install_isr
      16   RealTimeClock_Interrupt
        16   -> RealTimeClock_OnAlarm
       0   RealTimeClock_SetClockConfiguration
      20   RealTimeClock_SetTime


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable4
       4  ??DataTable5
       4  ??DataTable5_1
       4  ??DataTable5_10
       4  ??DataTable5_11
       4  ??DataTable5_12
       4  ??DataTable5_13
       4  ??DataTable5_14
       4  ??DataTable5_15
       4  ??DataTable5_16
       4  ??DataTable5_17
       4  ??DataTable5_18
       4  ??DataTable5_2
       4  ??DataTable5_3
       4  ??DataTable5_4
       4  ??DataTable5_5
       4  ??DataTable5_6
       4  ??DataTable5_7
       4  ??DataTable5_8
       4  ??DataTable5_9
      16  DevDataPtr__DEFAULT_RTOS_ALLOC
      16  LY
      28  MONTH_DAYS
      18  RealTimeClock_Disable
      18  RealTimeClock_Enable
     202  RealTimeClock_GetTime
     122  RealTimeClock_Init
      64  RealTimeClock_Interrupt
       2  RealTimeClock_SetClockConfiguration
     208  RealTimeClock_SetTime
      16  ULY

 
  16 bytes in section .bss
  60 bytes in section .rodata
 714 bytes in section .text
 
 714 bytes of CODE  memory
  60 bytes of CONST memory
  16 bytes of DATA  memory

Errors: none
Warnings: none
